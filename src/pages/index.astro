---
import Layout from '../layouts/Layout.astro';
import Biography from '../components/Biography.astro';
import Experience from '../components/Experience.astro';
import BlogPostCard from '../components/BlogPostCard.astro';
import PublicationCard from '../components/PublicationCard.astro';
import ViewAsMarkdown from '../components/ViewAsMarkdown';
import { getCollection } from 'astro:content';
import { PUBLICATIONS } from '../data/publications';
import { SITE, BIOGRAPHY } from '../data/site';
import { generateHomePageMarkdown } from '../utils/markdown-generator';

const blogPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

const homePageMarkdown = generateHomePageMarkdown(blogPosts);

// AI discoverability: Generate JSON-LD structured data for CollectionPage schema
const collectionPageSchema = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: SITE.title,
  url: SITE.url,
  description: SITE.description,
  mainEntity: {
    '@type': 'Person',
    name: BIOGRAPHY.name,
    jobTitle: BIOGRAPHY.role,
    url: SITE.url,
    sameAs: BIOGRAPHY.social.map(s => s.url),
    worksFor: {
      '@type': 'Organization',
      name: BIOGRAPHY.organization.name,
      url: BIOGRAPHY.organization.url
    }
  }
};

// AI discoverability: Enhanced Person schema with detailed information
const detailedPersonSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: BIOGRAPHY.name,
  jobTitle: BIOGRAPHY.role,
  url: SITE.url,
  description: BIOGRAPHY.bio,
  sameAs: BIOGRAPHY.social.map(s => s.url),
  worksFor: {
    '@type': 'Organization',
    name: BIOGRAPHY.organization.name,
    url: BIOGRAPHY.organization.url
  },
  alumniOf: BIOGRAPHY.education.map(edu => ({
    '@type': 'EducationalOrganization',
    name: edu.institution
  }))
};
---

<Layout 
  title="Daniel Fridljand - Software Consultant"
  description={SITE.description}
  url={SITE.url}
>
  {/* AI discoverability: JSON-LD structured data for CollectionPage */}
  <script type="application/ld+json" set:html={JSON.stringify(collectionPageSchema)} />
  
  {/* AI discoverability: JSON-LD structured data for detailed Person information */}
  <script type="application/ld+json" set:html={JSON.stringify(detailedPersonSchema)} />
  <section
    id="home"
    class="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#004ba0] to-[#1976d2] text-white scroll-mt-20"
  >
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-5xl md:text-6xl font-bold mb-4">Daniel Fridljand</h1>
      <p class="text-2xl md:text-3xl mb-8">Software Consultant</p>
      <p class="text-xl opacity-90">TNG technology</p>
    </div>
  </section>

  <Biography markdownHref="/index.md" />

  <section id="posts" class="py-16 bg-surface scroll-mt-20">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-3xl font-bold mb-8 text-heading">
          Posts
        </h2>
        <div class="grid md:grid-cols-2 gap-6">
          {blogPosts.map((post) => (
            <BlogPostCard
              title={post.data.title}
              description={post.data.description}
              pubDate={post.data.pubDate}
              slug={post.id}
              image={post.data.image}
              tags={post.data.tags}
            />
          ))}
        </div>
      </div>
    </div>
  </section>

  <Experience />

  <section id="publications" class="py-16 bg-surface-alt scroll-mt-20">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-3xl font-bold mb-8 text-heading">
          Publications
        </h2>
        <div class="space-y-6">
          {PUBLICATIONS.map((pub) => (
            <PublicationCard publication={pub} />
          ))}
        </div>
      </div>
    </div>
  </section>
</Layout>
