# render.yaml
services:
  # Define a Web Service
  - type: web
    name: cv-chat-app
    # Use the Native Node Runtime (Much lighter than Docker)
    runtime: node
    # Explicitly request the Free Plan
    plan: free
    # Region selection (optional, defaults to Oregon)
    region: frankfurt
      
    # Build Command:
    # 1. Install dependencies (including production deps)
    # 2. Build the Astro site (outputs to dist/)
    buildCommand: npm install && npm run build
      
    # Start Command:
    # Execute the standalone server script generated by the Node adapter.
    # This is critical: Do not use 'npm start' unless that script runs this file.
    startCommand: node ./dist/server/entry.mjs
      
    # Environment Variables
    envVars:
      # The API Key.
      # sync: false means Render will NOT overwrite the value in the dashboard
      # with what is here (which is nothing). It forces the user to input
      # the secret in the Render Dashboard safely.
      - key: GEMINI_API_KEY
        sync: false
          
      # Secret Password
      # sync: false means Render will NOT overwrite the value in the dashboard
      # with what is here (which is nothing). It forces the user to input
      # the secret in the Render Dashboard safely.
      - key: secret_password
        sync: false
          
      # Port configuration. Astro adapter listens on process.env.PORT
      # Render provides this variable automatically (usually 10000).
      - key: PORT
        value: 10000
          
    # Health Check (Optional)
    # Tells Render the service is ready when this path returns 200 OK
    healthCheckPath: /api/health
      
    # Scaling settings for the free tier
    # (Free tier is fixed to 1 instance, but good to be explicit)
    numInstances: 1

